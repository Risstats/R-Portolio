Departure Delays with {dplyr}
================
Larissa Shaughnessy
3/24/2022

I want to use my newly developed skills in {dplyr} to do a quick
exercise in joining and manipulating data. To do this, I will use the
{nycflights13} package, which contains data regarding the flights that
departed all NYC-area airports in 2013.

I want to find which combinations of airline and airport have the
smallest departure delays on average.

First I will inspect the data frames I want to join for my analysis.

``` r
glimpse(flights)
```

    ## Rows: 336,776
    ## Columns: 19
    ## $ year           <int> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
    ## $ month          <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ day            <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ dep_time       <int> 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
    ## $ sched_dep_time <int> 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
    ## $ dep_delay      <dbl> 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
    ## $ arr_time       <int> 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
    ## $ sched_arr_time <int> 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
    ## $ arr_delay      <dbl> 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
    ## $ carrier        <chr> "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
    ## $ flight         <int> 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
    ## $ tailnum        <chr> "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
    ## $ origin         <chr> "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
    ## $ dest           <chr> "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
    ## $ air_time       <dbl> 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
    ## $ distance       <dbl> 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
    ## $ hour           <dbl> 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
    ## $ minute         <dbl> 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
    ## $ time_hour      <dttm> 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…

``` r
glimpse(airlines)
```

    ## Rows: 16
    ## Columns: 2
    ## $ carrier <chr> "9E", "AA", "AS", "B6", "DL", "EV", "F9", "FL", "HA", "MQ", "O…
    ## $ name    <chr> "Endeavor Air Inc.", "American Airlines Inc.", "Alaska Airline…

``` r
glimpse(airports)
```

    ## Rows: 1,458
    ## Columns: 8
    ## $ faa   <chr> "04G", "06A", "06C", "06N", "09J", "0A9", "0G6", "0G7", "0P2", "…
    ## $ name  <chr> "Lansdowne Airport", "Moton Field Municipal Airport", "Schaumbur…
    ## $ lat   <dbl> 41.13047, 32.46057, 41.98934, 41.43191, 31.07447, 36.37122, 41.4…
    ## $ lon   <dbl> -80.61958, -85.68003, -88.10124, -74.39156, -81.42778, -82.17342…
    ## $ alt   <dbl> 1044, 264, 801, 523, 11, 1593, 730, 492, 1000, 108, 409, 875, 10…
    ## $ tz    <dbl> -5, -6, -6, -5, -5, -5, -5, -5, -5, -8, -5, -6, -5, -5, -5, -5, …
    ## $ dst   <chr> "A", "A", "A", "A", "A", "A", "A", "A", "U", "A", "A", "U", "A",…
    ## $ tzone <chr> "America/New_York", "America/Chicago", "America/Chicago", "Ameri…

I will inner join the flights data frame with the airlines data frame on
the carrier columns to create the new data frame, flights\_airlines.
Then, I will check the structure of flights\_airlines to ensure it is
correct - it should have 20 columns, including the “name” column from
the airlines data frame.

``` r
#Because the columns I am joining are called "carrier" in both data frames and there are  
#no other duplicate variables in the data frames I will not need to specify the by argument  
#for the function inner_join() - a natural join will be performed on "carrier" by default. 
flights_airlines <- inner_join(x=flights, y=airlines)
```

    ## Joining, by = "carrier"

``` r
glimpse(flights_airlines)
```

    ## Rows: 336,776
    ## Columns: 20
    ## $ year           <int> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
    ## $ month          <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ day            <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ dep_time       <int> 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
    ## $ sched_dep_time <int> 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
    ## $ dep_delay      <dbl> 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
    ## $ arr_time       <int> 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
    ## $ sched_arr_time <int> 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
    ## $ arr_delay      <dbl> 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
    ## $ carrier        <chr> "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
    ## $ flight         <int> 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
    ## $ tailnum        <chr> "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
    ## $ origin         <chr> "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
    ## $ dest           <chr> "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
    ## $ air_time       <dbl> 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
    ## $ distance       <dbl> 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
    ## $ hour           <dbl> 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
    ## $ minute         <dbl> 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
    ## $ time_hour      <dttm> 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…
    ## $ name           <chr> "United Air Lines Inc.", "United Air Lines Inc.", "Amer…

Everything looks good in flights\_airlines, so now I will inner join
with the airports data frame on the columns containing the FAA airport
code and to create the new data frame joined\_flight.dt.

``` r
#I need to specify the columns to join on since they do not have the same variable name.    
#To do this I will simply include the by argument in the inner_join() function.  
#There is also a duplicate variable that I do not want to join in our data frames ("name")  
#so, I need to also include the suffix argument in order to disambiguate the columns containing  
#the names of the airlines from the column containing the names of the airports.  
joined_flight.dt <- inner_join(flights_airlines, 
                               airports, 
                               by = c("origin" = "faa"),
                               suffix = c("_airline", "_airport"))
```

Now I will check the structure of joined\_flight.dt to make sure it has
27 rows and that our suffixes were added to the name columns to create
“name\_airline” and “name\_airport”.

``` r
glimpse(joined_flight.dt)
```

    ## Rows: 336,776
    ## Columns: 27
    ## $ year           <int> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…
    ## $ month          <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ day            <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ dep_time       <int> 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …
    ## $ sched_dep_time <int> 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …
    ## $ dep_delay      <dbl> 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…
    ## $ arr_time       <int> 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…
    ## $ sched_arr_time <int> 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…
    ## $ arr_delay      <dbl> 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…
    ## $ carrier        <chr> "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B6", "…
    ## $ flight         <int> 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…
    ## $ tailnum        <chr> "N14228", "N24211", "N619AA", "N804JB", "N668DN", "N394…
    ## $ origin         <chr> "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "LGA",…
    ## $ dest           <chr> "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "IAD",…
    ## $ air_time       <dbl> 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…
    ## $ distance       <dbl> 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …
    ## $ hour           <dbl> 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…
    ## $ minute         <dbl> 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…
    ## $ time_hour      <dttm> 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…
    ## $ name_airline   <chr> "United Air Lines Inc.", "United Air Lines Inc.", "Amer…
    ## $ name_airport   <chr> "Newark Liberty Intl", "La Guardia", "John F Kennedy In…
    ## $ lat            <dbl> 40.69250, 40.77725, 40.63975, 40.63975, 40.77725, 40.69…
    ## $ lon            <dbl> -74.16867, -73.87261, -73.77893, -73.77893, -73.87261, …
    ## $ alt            <dbl> 18, 22, 13, 13, 22, 18, 18, 22, 13, 22, 13, 13, 13, 18,…
    ## $ tz             <dbl> -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5, -5,…
    ## $ dst            <chr> "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", "A", …
    ## $ tzone          <chr> "America/New_York", "America/New_York", "America/New_Yo…

The last data frame I create, dep\_delay.dt, will be used for my
analysis and will include only the variables I am interested in - the
names of the airlines, the names of the airports, and the departure
delays. I will check to make sure the dep\_delay.dt data frame contains
the correct three variables before performing the analysis.

``` r
dep_delay.dt <- joined_flight.dt %>%
  select(name_airline, name_airport, dep_delay)
glimpse(dep_delay.dt)
```

    ## Rows: 336,776
    ## Columns: 3
    ## $ name_airline <chr> "United Air Lines Inc.", "United Air Lines Inc.", "Americ…
    ## $ name_airport <chr> "Newark Liberty Intl", "La Guardia", "John F Kennedy Intl…
    ## $ dep_delay    <dbl> 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1, …

Finally, to answer my original question, I will first group the data by
airline and flight origin airport. Then, I will calculate the average
departure delay for each of these groups and sort them in ascending
order to find which combination of airline and airport has the smallest
average departure delay.

``` r
#To calculate the average departure delay across my grouped data, I will use summarize() with  
#nested round() and mean() functions, and the specified .groups argument to ensure that the  
#grouping is passed through.  
#Nothing needs to be specified for arrange() to sort in ascending order as that is the default.  
dep_delay.dt %>%
  group_by(name_airline, name_airport) %>% 
  summarize(avg_dep_delay = round(mean(dep_delay, na.rm=TRUE),2), .groups = "keep") %>%
  arrange(avg_dep_delay) 
```

    ## # A tibble: 35 × 3
    ## # Groups:   name_airline, name_airport [35]
    ##    name_airline           name_airport        avg_dep_delay
    ##    <chr>                  <chr>                       <dbl>
    ##  1 US Airways Inc.        La Guardia                   3.31
    ##  2 US Airways Inc.        Newark Liberty Intl          3.74
    ##  3 Hawaiian Airlines Inc. John F Kennedy Intl          4.9 
    ##  4 Alaska Airlines Inc.   Newark Liberty Intl          5.8 
    ##  5 US Airways Inc.        John F Kennedy Intl          5.87
    ##  6 Endeavor Air Inc.      Newark Liberty Intl          5.95
    ##  7 American Airlines Inc. La Guardia                   6.71
    ##  8 United Air Lines Inc.  John F Kennedy Intl          7.9 
    ##  9 Delta Air Lines Inc.   John F Kennedy Intl          8.33
    ## 10 Envoy Air              La Guardia                   8.53
    ## # … with 25 more rows

So there we have it! It seems that US Airways is the best airline to fly
out of NYC on if you want to avoid significant departure delays.

Of course, there are several variables that could affect delays and we
could go much deeper into our analysis. of seasonal and day-to-day
variances in the departure delays. This data is also nearly a decade
old, and was obviously not subject to the affects of COVID-19 on the
airline industry, so it is likely no longer relevant to finding the true
answer to our question - that being said, it has provided great practice
with the dplyr package!
