---
title: "Departure Delays with {dplyr}"
author: "Larissa Shaughnessy"
date: "3/24/2022"
output: github_document
---

I want to use my newly developed skills in {dplyr} to do a quick exercise in joining and manipulating data. To do this, I will use the {nycflights13} package, which contains data regarding the flights that departed all NYC-area airports in 2013. 

I want to find which combinations of airline and airport have the smallest departure delays on average.

```{r, include=FALSE}
library(dplyr)
library(nycflights13)
```


First I will inspect the data frames I want to join for my analysis.
```{r}
glimpse(flights)
glimpse(airlines)
glimpse(airports)
```

I will inner join the flights data frame with the airlines data frame on the carrier columns to create the new data frame, flights_airlines. Then, I will check the structure of flights_airlines to ensure it is correct - it should have 20 columns, including the "name" column from the airlines data frame.
```{r}
#Because the columns I am joining are called "carrier" in both data frames and there are no other duplicate variables in the data frames I will not need to specify the by argument for the function inner_join() - a natural join will be performed on "carrier" by default. 
flights_airlines <- inner_join(x=flights, y=airlines)
glimpse(flights_airlines)
```


Everything looks good in flights_airlines, so now I will inner join with the airports data frame on the columns containing the FAA airport code and to create the new data frame joined_flight.dt.
```{r}
#I need to specify the columns to join on since they do not have the same variable name. To do this I will simply include the by argument in the inner_join() function. There is also a duplicate variable that I do not want to join in our data frames ("name"), so I need to also include the suffix argument in order to disambiguate the columns containing the names of the airlines from the column containing the names of the airports.  
joined_flight.dt <- inner_join(flights_airlines, airports, by = c("origin" = "faa"), suffix = c("_airline", "_airport"))
```

Now I will check the structure of joined_flight.dt to make sure it has 27 rows and that our suffixes were added to the name columns to create "name_airline" and "name_airport". 
```{r}
glimpse(joined_flight.dt)
```

The last data frame I create, dep_delay.dt, will be used for my analysis and will include only the variables I am interested in - the names of the airlines, the names of the airports, and the departure delays. I will check to make sure the dep_delay.dt data frame contains the correct three variables before performing the analysis. 

```{r}
dep_delay.dt <- joined_flight.dt %>% select(name_airline, name_airport, dep_delay)
glimpse(dep_delay.dt)
```

Finally, to answer my original question, I will first group the data by airline and flight origin airport. Then, I will calculate the average departure delay for each of these groups and sort them in ascending order to find which combination of airline and airport has the smallest average departure delay. 
```{r} 
#To calculate the average departure delay across my grouped data, I will use the summarize() with nested round() and mean() functions, and the specified .groups argument to ensure that the grouping is passed through. Nothing needs to be specified for arrange() to sort in ascending order as that is the default for the function.
dep_delay.dt %>% group_by(name_airline, name_airport) %>% 
  summarize(avg_dep_delay = round(mean(dep_delay, na.rm=TRUE),2), .groups = "keep") %>%
  arrange(avg_dep_delay) 
```
So there we have it! It seems that US Airways is the best airline to fly out of NYC on if you want to avoid significant departure delays.

Of course, there are several variables that could affect delays and we could go much deeper into our analysis. of seasonal and day-to-day variances in the departure delays. This data is also nearly a decade old, and was obviously not subject to the affects of COVID-19 on the airline industry, so it is likely no longer relevant to finding the true answer to our question - that being said, it has provided great practice with the dplyr package! 