---
title: "Departure Delays with {dplyr}"
author: "Larissa Shaughnessy"
date: "3/24/2022"
output: html_document
---

I want to use my newly developed skills in the dplyr package to do a quick exercise in joining and manipulating data. To do this, I will use the nyflights13 package, which contains data regarding the flights that departed all NYC-area airports in 2013. 

I want to find which combinations of airline and airport have the smallest departure delays on average.

First I will load the dplyr package and then I will inspect the dataframes I want to join for my analysis using glimpse(). 
```{r}
library(dplyr)
glimpse(flights)
glimpse(airlines)
glimpse(airports)
```

I will perform an inner join with flights and airlines on the carrier column to create a new data frame, flights_airlines.  
```{r}
 #Because the columns I am joining are called "carrier" in both data frames and there are no other duplicate variables in the data frames I will not need to specify the by argument for the function inner_join() - a natural join will be performed on "carrier" by default. 
flights_airlines <- inner_join(x=flights, y=airlines)
```

Now I will check the structure of flights_airlines to make sure it is correct - it should have 20 columns, including the "name" column from the airlines data frame.  
```{r}
glimpse(flights_airlines)
```

Everything looks good in flights_airlines, so I will perform another inner join with the airports data frame on the columns containing the FAA airport code and to create the new data frame joined_flight_data.
```{r}
#I need to specify the columns to join on since they do not have the same variable name. To do this I will simply include the by argument in the inner_join() function. There is also a duplicate variable that I do not want to join in our data frames ("name"), so I need to also include the suffix argument in order to disambiguate the columns containing the names of the airlines from the column containing the names of the airports.  
joined_flight_data <- inner_join(flights_airlines, airports, by = c("origin" = "faa"), suffix = c("airline", "airport"))
```

Now I will check the structure of joined_flight_data to make sure it has 27 rows and that our suffixes were added to the name columns to create "nameairline" and "nameairport". 
```{r}
glimpse(joined_flight_data)
```

The last data frame I create, selected_flight_data, will be used for my analysis and will include only the variables I am interested in - the names of the airlines, the names of the airports, and the departure delays. 

```{r}
selected_flight_data <- joined_flight_data %>% select(nameairline, nameairport, dep_delay)
```

I will check the structure of selected_flight_data to make sure it contains the correct 3 columns. 
```{r}
glimpse(selected_flight_data)
```

Finally, to answer my original question, I will first group the data by airline and flight origin airport. Then, I will calculate the average departure delay for each of these groups and sort them in ascending order to find which combination of airline and airport has the smallest average departure delay. 
```{r} 
#To calculate the average departure delay across my grouped data, I will use the summarize() with nested round() and mean() functions, and the specified .groups argument to ensure that the grouping is passed through. Nothing needs to be specified for arrange() to sort in ascending order as that is the default for the function.
selected_flight_data %>% group_by(nameairline, nameairport) %>% 
  summarize(avg_dep_delay = round(mean(dep_delay, na.rm=TRUE),2), .groups = "keep") %>%
  arrange(avg_dep_delay) 
```
So there we have it! It seems that US Airways is the best airline to fly out of NYC on if you want to avoid significant departure delays. Of course, there are other variables that could affect this and we could do deeper analysis of seasonal and day-to-day variances in the departure delays. This data is also nearly a decade old, and was obviously not subject to the affects of COVID-19 on the airline industry, so it is likely no longer relevant to finding the true answer to our question - that being said, it has provided great practice with the dplyr package! 